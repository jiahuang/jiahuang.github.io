<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Making an email client plugin for N1 | Jia Huang</title><meta name="description"><meta name="generator" content="Jia Huang"><meta name="author" content="Jia Huang"><meta name="keywords" content="jia huang, node.js, javascript, golang, scala, development"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" href="/images/svdb.png"><link rel="icon" type="image/png" href="/images/svdb.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/svdb.png"></head><body itemscope itemtype="https://schema.org/WebPage"><header itemscope itemtype="https://schema.org/WPHeader"><img src="/images/profile.png"><h1><a href="/" alt="Jia Huang" title="Jia Huang" itemprop="headline">Jia Huang</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/articles" alt="Writings" title="Writings" itemprop="url">Writings</a></li><li itemprop="name"><a href="/talks" alt="Talks" title="Talks" itemprop="url">Talks</a></li><li itemprop="name"><a href="/projects" alt="Projects" title="Projects" itemprop="url">Projects</a></li><li itemprop="name"><a href="/about" alt="About" title="About" itemprop="url">About</a></li><li><a href="https://github.com/jiahuang"> <img src="/images/github.png" style="height:25px;"></a><a href="https://twitter.com/jia"> <img src="/images/twitter.png" style="height:30px;"></a></li></ul></nav></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">Making an email client plugin for N1</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2016-04-12T05:10:15.000Z"> Monday, April 11th 2016 at 22:10</time><br>Last updated on<time itemprop="dateModified" datetime="2016-04-12T05:10:15.000Z"> Sunday, April 24th 2016 at 16:27</time></span><p>This plugin works with <a href="https://nylas.com/" target="_blank" rel="external">N1</a> an open source email client made by Nylas. At the time of writing this, Nylas is going to phase out the current version of N1 and switch to a paid version. This plugin might not work for much longer, but learning React was a fun experience that I think is worthwhile to document.</p>
<p>The complete code can be found on <a href="https://github.com/jiahuang/n1-octopart-plugin" target="_blank" rel="external">github</a>.</p>
<p>When I was at Technical Machine, one of the most rewarding yet tedious tasks was sourcing electric components for our boards. Rewarding because any work had an immediate effect – 10 cents saved on one part can easily add up to thousands of dollars. Tedious and boring because the work was route enough that it didn’t require too much thought, but juuuuust complicated enough to require actual work. It’s like an uncanny valley of thinking.</p>
<p>One thing that would have helped me out was an easy way to look up the part numbers that were always circulating around in my email. I was playing around with N1, and realized I could do just that, so I did:</p>
<p><img src="https://raw.githubusercontent.com/jiahuang/n1-octopart-plugin/master/octopart-sidebar.png" alt="octopart plugin"></p>
<p>Yeah it’s weird that the price at 1 unit is lower than 10. It could just mean that the supplier only had &lt;10 units.</p>
<p>The plugin is simple. It plugs into the <a href="">Octopart</a> api and pulls for matching part numbers &amp; the pricing associated with it at 1, 10, 100, and 1k units.</p>
<p>This was also my first time using React.</p>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><p>N1 has some great <a href="http://nylas.github.io/N1/docs/" target="_blank" rel="external">documentation</a> and <a href="https://github.com/nylas/N1/tree/master/internal_packages/github-contact-card" target="_blank" rel="external">sample code</a> that I used as a starting point. N1 has some default code that it gives developers by going to “Develop -&gt; Create a plugin”, but it differentiated from the sample code, so I went with what was in the sample code instead.</p>
<p>Custom made packages are all in <code>~/.nylas/dev/packages</code>.</p>
<p>The basic format of a plugin looks like:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/assets</span><br><span class="line">/lib</span><br><span class="line">  main.es6</span><br><span class="line">  display.jsx</span><br><span class="line">  store.es6</span><br><span class="line">/stylesheets</span><br><span class="line">  main.less</span><br><span class="line">package.json</span><br></pre></td></tr></table></figure></p>
<h2 id="Hooking-it-up"><a href="#Hooking-it-up" class="headerlink" title="Hooking it up"></a>Hooking it up</h2><p><code>main.es6</code> registers the custom react component and tells N1 where to render the plugin.</p>
<p>There’s a great tool under “Developer -&gt; Toggle component regions” that shows the names of different regions. As far as I can tell, the regions are separated into “locations” and “roles”. The example sample code adds a component inside of an existing N1 component (the contact card), so it is located in a role. My octopart plugin is a new component, so it’s just placed in a location.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ComponentRegistry.register(OctopartSidebar, &#123;</span><br><span class="line">    location: WorkspaceStore.Location.MessageListSidebar,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Calling-Octopart"><a href="#Calling-Octopart" class="headerlink" title="Calling Octopart"></a>Calling Octopart</h2><p>The bulk of the code in the “datastore” of the react component consisted of an API call to Octopart and parsing the results.</p>
<p>Octopart’s API returns the image, description, and a series of bids from multiple suppliers of part prices at varying quantities, usually with prices logrithmically dropping to quantity purchased. My plugin just finds the cheapest bid at each quantity interval that I care about.</p>
<p>This data is returned as a json obj in the form of:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">that._part = &#123;description: description,</span><br><span class="line">  image: image, <span class="comment">// is a url</span></span><br><span class="line">  manufacturer: manufacturer, <span class="comment">// has &#123;name, url&#125;</span></span><br><span class="line">  prices: prices, <span class="comment">// has &#123;qty, price, link&#125;</span></span><br><span class="line">  mpn: mpn <span class="comment">// manufacturer's part number</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This contains all the information needed to render the plugin’s results.</p>
<h2 id="Rendering"><a href="#Rendering" class="headerlink" title="Rendering"></a>Rendering</h2><p>The UI components are an input box and a button.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    const content = this.state.error ? this._renderError() : this._renderResults();</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;octopartDiv&quot;&gt;</span><br><span class="line">        &lt;form className=&quot;octopartForm&quot; onSubmit=&#123;this._handleSubmit&#125;&gt;</span><br><span class="line">          &lt;label className=&quot;octopartLabel&quot;&gt;Octopart Search&lt;/label&gt;</span><br><span class="line">          &lt;input className=&quot;octopartInput&quot; type=&quot;text&quot; value=&#123;this.state.searchText&#125; onChange=&#123;this._handleChange&#125;/&gt;</span><br><span class="line">          &lt;input className=&quot;octopartInput octopartButton&quot; type=&quot;submit&quot; value=&quot;Search&quot;/&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">        &#123;content&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>The part that threw me off the most was having text appear in the input box as the user typed it. Because data is only rendered by <code>value={this.state.searchText}</code>, any text entered into the input box must be passed back into the react element and then re-rendered.</p>
<p>So basically text got entered into the input box which had an event: <code>onChange={this._handleChange}</code>.</p>
<p>And the <code>_handleChange</code> function reset what <code>this.state.searchText</code> was equal to:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_handleChange = (event) =&gt; &#123;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;searchText: event.target.value&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The submit button called a <code>_handleSubmit</code> function that called the Octopart store:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_handleSubmit = (event) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> search = <span class="keyword">this</span>.state.searchText.trim();</span><br><span class="line">  OctopartStore._getPart(search)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And then the OctopartStore triggered a re-render to return back the results of the Octopart search.</p>
<h2 id="Overall"><a href="#Overall" class="headerlink" title="Overall"></a>Overall</h2><p>Plugin-wise, a more useful integration would be to hook up the Octopart BoM (Bill of Materials) API. Parts for the BoM are usually decided over email, so it would be a really quick and easy workflow to integrate in part ordering. I also had to email BoMs back and forth between CMs (contract manufacturers), so having something always up to date that is linked to the version that the CM has would be a nice safety check.</p>
<p>React was much easier to pick up compared to the only other front-end JS framework I’ve used – Angular 1.0 (back in like 2012). Angular had so many specialized html hookups, so on top of learning a new framework, I also had to relearn the existing html framework I already knew. Angular was always kind of magical in how data flowed from the view back to the controller and so forth. As long as it was hooked up correctly, it would “just work”, but finding the magic key words for a proper hookup took a lot of googling.</p>
<p>React’s flow is much more obvious (like having to call <code>.setState</code> for instance). I didn’t read much of the official React docs, but was able to basically get something working by following method calls.</p>
<p>Full code is on <a href="https://github.com/jiahuang/n1-octopart-plugin" target="_blank" rel="external">github</a>.</p>
</article></main></body></html>