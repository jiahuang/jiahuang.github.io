<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Using Istanbul for code coverage | Jia Huang</title><meta name="description"><meta name="generator" content="Jia Huang"><meta name="author" content="Jia Huang"><meta name="keywords" content="jia huang, node.js, javascript, golang, scala, development"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" href="/images/svdb.png"><link rel="icon" type="image/png" href="/images/svdb.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/svdb.png"></head><body itemscope itemtype="https://schema.org/WebPage"><header itemscope itemtype="https://schema.org/WPHeader"><img src="/images/profile.png"><h1><a href="/" alt="Jia Huang" title="Jia Huang" itemprop="headline">Jia Huang</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/articles" alt="Writings" title="Writings" itemprop="url">Writings</a></li><li itemprop="name"><a href="/talks" alt="Talks" title="Talks" itemprop="url">Talks</a></li><li itemprop="name"><a href="/projects" alt="Projects" title="Projects" itemprop="url">Projects</a></li><li itemprop="name"><a href="/about" alt="About" title="About" itemprop="url">About</a></li><li><a href="https://github.com/jiahuang"> <img src="/images/github.png" style="height:25px;"></a><a href="https://twitter.com/jia"> <img src="/images/twitter.png" style="height:30px;"></a></li></ul></nav></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">Using Istanbul for code coverage</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2016-12-11T04:27:00.000Z"> Saturday, December 10th 2016 at 20:27</time><br>Last updated on<time itemprop="dateModified" datetime="2016-12-11T04:27:00.000Z"> Sunday, December 11th 2016 at 18:07</time></span><p>I’ve been using <a href="https://github.com/gotwarlost/istanbul" target="_blank" rel="external">Istanbul</a>, a JS <a href="https://en.wikipedia.org/wiki/Code_coverage" target="_blank" rel="external">code coverage</a> library. Istanbul outputs a report that shows which lines are hit during unit tests:</p>
<p><img src="/images/istanbul-overview.png" alt="istanbul report"></p>
<p>Istanbul can be installed with:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g istanbul</span><br></pre></td></tr></table></figure></p>
<h2 id="How-Istanbul-works"><a href="#How-Istanbul-works" class="headerlink" title="How Istanbul works"></a>How Istanbul works</h2><p>Istanbul wraps all your code with functions that track how often each function, line, and branch in the code got hit while running unit tests. It stores this data in a <code>coverage.json</code> file which can then be used to generate html, lcov, or other kinds of reports.</p>
<p>The process of wrapping code with tracking functions is called “instrumentation”. Istanbul relies on the <a href="http://esprima.org/" target="_blank" rel="external">esprima</a> package to parse JS source code. Then <a href="https://github.com/estools/escodegen" target="_blank" rel="external">escodegen</a> is used to add in the coverage code and to output a new instrumented source file.</p>
<p>Given a source file <code>person.js</code> that looks like:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, dob</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.dob = dob;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.isMinor = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> currDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">if</span> ((currDate.getTime() - <span class="keyword">this</span>.dob.getTime())/(<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">365.25</span>) &lt; <span class="number">18.0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Person;</span><br></pre></td></tr></table></figure>
<p>Istanbul can create the instrumented code via: <code>istanbul instrument --no-compact -o tmp/instrument/person.js person.js</code>. This creates a instrumented <code>person.js</code> file in <code>tmp/instrument/person.js</code>.</p>
<p>The <code>tmp/instrument/person.js</code> file looks like this. I added some comments to detail what is happening:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a temp __cov_X9N6pGXtRbutT8pzNmQHeA obj is created</span></span><br><span class="line"><span class="keyword">var</span> __cov_X9N6pGXtRbutT8pzNmQHeA = (<span class="built_in">Function</span>(<span class="string">'return this'</span>))();</span><br><span class="line"></span><br><span class="line"><span class="comment">// there's a __coverage__ obj that is used to track coverage. The name of this object can change depending on settings, but __coverage is the default.</span></span><br><span class="line"><span class="keyword">if</span> (!__cov_X9N6pGXtRbutT8pzNmQHeA.__coverage__) &#123; __cov_X9N6pGXtRbutT8pzNmQHeA.__coverage__ = &#123;&#125;; &#125;</span><br><span class="line">__cov_X9N6pGXtRbutT8pzNmQHeA = __cov_X9N6pGXtRbutT8pzNmQHeA.__coverage__;</span><br><span class="line"><span class="keyword">if</span> (!(__cov_X9N6pGXtRbutT8pzNmQHeA[<span class="string">'/Users/jia/code/jiahuang.github.io/person.js'</span>])) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// the initialized __coverage__ obj. This already has details for all of the main source code (such as line numbers, functions, and branches that have been tested)</span></span><br><span class="line">   __cov_X9N6pGXtRbutT8pzNmQHeA[<span class="string">'/Users/jia/code/jiahuang.github.io/person.js'</span>] = &#123;<span class="string">"path"</span>:<span class="string">"/Users/jia/code/jiahuang.github.io/person.js"</span>,<span class="string">"s"</span>:&#123;<span class="string">"1"</span>:<span class="number">1</span>,<span class="string">"2"</span>:<span class="number">0</span>,<span class="string">"3"</span>:<span class="number">0</span>,<span class="string">"4"</span>:<span class="number">0</span>,<span class="string">"5"</span>:<span class="number">0</span>,<span class="string">"6"</span>:<span class="number">0</span>,<span class="string">"7"</span>:<span class="number">0</span>,<span class="string">"8"</span>:<span class="number">0</span>&#125;,<span class="string">"b"</span>:&#123;<span class="string">"1"</span>:[<span class="number">0</span>,<span class="number">0</span>]&#125;,<span class="string">"f"</span>:&#123;<span class="string">"1"</span>:<span class="number">0</span>,<span class="string">"2"</span>:<span class="number">0</span>&#125;,<span class="string">"fnMap"</span>:&#123;<span class="string">"1"</span>:&#123;<span class="string">"name"</span>:<span class="string">"Person"</span>,<span class="string">"line"</span>:<span class="number">1</span>,<span class="string">"loc"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">1</span>,<span class="string">"column"</span>:<span class="number">0</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">1</span>,<span class="string">"column"</span>:<span class="number">27</span>&#125;&#125;&#125;,<span class="string">"2"</span>:&#123;<span class="string">"name"</span>:<span class="string">"(anonymous_2)"</span>,<span class="string">"line"</span>:<span class="number">6</span>,<span class="string">"loc"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">6</span>,<span class="string">"column"</span>:<span class="number">27</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">6</span>,<span class="string">"column"</span>:<span class="number">39</span>&#125;&#125;&#125;&#125;,<span class="string">"statementMap"</span>:&#123;<span class="string">"1"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">1</span>,<span class="string">"column"</span>:<span class="number">0</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">4</span>,<span class="string">"column"</span>:<span class="number">1</span>&#125;&#125;,<span class="string">"2"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">2</span>,<span class="string">"column"</span>:<span class="number">2</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">2</span>,<span class="string">"column"</span>:<span class="number">19</span>&#125;&#125;,<span class="string">"3"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">3</span>,<span class="string">"column"</span>:<span class="number">2</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">3</span>,<span class="string">"column"</span>:<span class="number">17</span>&#125;&#125;,<span class="string">"4"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">6</span>,<span class="string">"column"</span>:<span class="number">0</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">13</span>,<span class="string">"column"</span>:<span class="number">1</span>&#125;&#125;,<span class="string">"5"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">7</span>,<span class="string">"column"</span>:<span class="number">2</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">7</span>,<span class="string">"column"</span>:<span class="number">28</span>&#125;&#125;,<span class="string">"6"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">8</span>,<span class="string">"column"</span>:<span class="number">2</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">12</span>,<span class="string">"column"</span>:<span class="number">3</span>&#125;&#125;,<span class="string">"7"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">9</span>,<span class="string">"column"</span>:<span class="number">4</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">9</span>,<span class="string">"column"</span>:<span class="number">15</span>&#125;&#125;,<span class="string">"8"</span>:&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">11</span>,<span class="string">"column"</span>:<span class="number">4</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">11</span>,<span class="string">"column"</span>:<span class="number">16</span>&#125;&#125;&#125;,<span class="string">"branchMap"</span>:&#123;<span class="string">"1"</span>:&#123;<span class="string">"line"</span>:<span class="number">8</span>,<span class="string">"type"</span>:<span class="string">"if"</span>,<span class="string">"locations"</span>:[&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">8</span>,<span class="string">"column"</span>:<span class="number">2</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">8</span>,<span class="string">"column"</span>:<span class="number">2</span>&#125;&#125;,&#123;<span class="string">"start"</span>:&#123;<span class="string">"line"</span>:<span class="number">8</span>,<span class="string">"column"</span>:<span class="number">2</span>&#125;,<span class="string">"end"</span>:&#123;<span class="string">"line"</span>:<span class="number">8</span>,<span class="string">"column"</span>:<span class="number">2</span>&#125;&#125;]&#125;&#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__cov_X9N6pGXtRbutT8pzNmQHeA = __cov_X9N6pGXtRbutT8pzNmQHeA[<span class="string">'/Users/jia/code/jiahuang.github.io/person.js'</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, dob</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// when this function is called, the number of times this function is called gets incremented</span></span><br><span class="line">    __cov_X9N6pGXtRbutT8pzNmQHeA.f[<span class="string">'1'</span>]++;</span><br><span class="line">    <span class="comment">// and the times this line is called also gets incremented</span></span><br><span class="line">    __cov_X9N6pGXtRbutT8pzNmQHeA.s[<span class="string">'2'</span>]++;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    __cov_X9N6pGXtRbutT8pzNmQHeA.s[<span class="string">'3'</span>]++;</span><br><span class="line">    <span class="keyword">this</span>.dob = dob;</span><br><span class="line">&#125;</span><br><span class="line">__cov_X9N6pGXtRbutT8pzNmQHeA.s[<span class="string">'4'</span>]++;</span><br><span class="line">Person.prototype.isMinor = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// similarly these also increment the number of times this function &amp; lines are called</span></span><br><span class="line">    __cov_X9N6pGXtRbutT8pzNmQHeA.f[<span class="string">'2'</span>]++;</span><br><span class="line">    __cov_X9N6pGXtRbutT8pzNmQHeA.s[<span class="string">'5'</span>]++;</span><br><span class="line">    <span class="keyword">var</span> currDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    __cov_X9N6pGXtRbutT8pzNmQHeA.s[<span class="string">'6'</span>]++;</span><br><span class="line">    <span class="keyword">if</span> ((currDate.getTime() - <span class="keyword">this</span>.dob.getTime()) / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">365.25</span>) &lt; <span class="number">18</span>) &#123;</span><br><span class="line">        <span class="comment">// because this is in an "if" statement, the number of branches called also gets incremented</span></span><br><span class="line">        __cov_X9N6pGXtRbutT8pzNmQHeA.b[<span class="string">'1'</span>][<span class="number">0</span>]++;</span><br><span class="line">        __cov_X9N6pGXtRbutT8pzNmQHeA.s[<span class="string">'7'</span>]++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        __cov_X9N6pGXtRbutT8pzNmQHeA.b[<span class="string">'1'</span>][<span class="number">1</span>]++;</span><br><span class="line">        __cov_X9N6pGXtRbutT8pzNmQHeA.s[<span class="string">'8'</span>]++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>So as the instrumented code is executed, a tmp object stores all the information about what lines have been called for a particular file. <strong>Note that the <code>istanbul instrument</code> command is only useful for browser based tests. I included the instrumented code here just to illustrate how Istanbul keeps track of coverage. For tests that can run on node, the regular <code>istanbul cover</code> command automatically instruments the code.</strong></p>
<h2 id="Istanbul-for-Node-tests"><a href="#Istanbul-for-Node-tests" class="headerlink" title="Istanbul for Node tests"></a>Istanbul for Node tests</h2><p>If we had a <a href="https://jasmine.github.io" target="_blank" rel="external">jasmine</a> test file <code>person.spec.js</code> like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = <span class="built_in">require</span>(<span class="string">'./person'</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">"A person"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">"can be a minor"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p = <span class="keyword">new</span> Person(<span class="string">"me"</span>, <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">"2000-03-06"</span>));</span><br><span class="line">    expect(p.isMinor()).toBe(<span class="literal">true</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>This can be run with <code>jasmine person.spec.js</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Started</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line">1 spec, 0 failures</span><br><span class="line">Finished <span class="keyword">in</span> 0.005 seconds</span><br></pre></td></tr></table></figure>
<p>Now to get the coverage of this file <code>person.spec.js</code> run <code>istanbul cover jasmine person.spec.js</code> to get the following output:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Started</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line">1 spec, 0 failures</span><br><span class="line">Finished <span class="keyword">in</span> 0.005 seconds</span><br><span class="line"></span><br><span class="line">=============================================================================</span><br><span class="line">Writing coverage object [/Users/jia/code/jiahuang.github.io/coverage/coverage.json]</span><br><span class="line">Writing coverage reports at [/Users/jia/code/jiahuang.github.io/coverage]</span><br><span class="line">=============================================================================</span><br><span class="line"></span><br><span class="line">=============================== Coverage summary ===============================</span><br><span class="line">Statements   : 92.86% ( 13/14 )</span><br><span class="line">Branches     : 50% ( 1/2 )</span><br><span class="line">Functions    : 100% ( 4/4 )</span><br><span class="line">Lines        : 92.86% ( 13/14 )</span><br><span class="line">================================================================================</span><br></pre></td></tr></table></figure>
<p>The report is generated at <code>coverage/lcov-report.index.html</code>:</p>
<p><img src="/images/istanbul-file.png" alt="person report"></p>
<p>Note that the statement % coverage is very high (88%). This is misleading because the tests only cover half of the branches (50%). Be sure to check coverage % across statements, branches, and functions.</p>
<h2 id="Istanbul-for-browser-tests"><a href="#Istanbul-for-browser-tests" class="headerlink" title="Istanbul for browser tests"></a>Istanbul for browser tests</h2><p>The previous example showed how to run Istanbul on node code. Running Istanbul on the browser requires a little more setup. For this example I’ll use the following:</p>
<ul>
<li><a href="http://phantomjs.org/" target="_blank" rel="external">PhantomJS</a>. Phantom is a headless browser that will allow us to test frontend UI code. <a href="https://github.com/tmpvar/jsdom" target="_blank" rel="external">jsdom</a> is another option, however jsdom does not handle things like <a href="https://github.com/tmpvar/jsdom/issues/1048" target="_blank" rel="external">hidden/visible elements properly</a>.</li>
<li><a href="http://gruntjs.com/" target="_blank" rel="external">Grunt</a>. I’m mainly using Grunt as the static server via <a href="https://github.com/gruntjs/grunt-contrib-connect" target="_blank" rel="external">grunt-contrib-connect</a> that can serve up tests for Phantom, and also write down the coverage data.</li>
<li><a href="https://jasmine.github.io/" target="_blank" rel="external">Jasmine</a> for running the unit tests.</li>
<li><a href="https://github.com/gruntjs/grunt-contrib-jasmine" target="_blank" rel="external">grunt-contrib-jasmine</a> A Grunt plugin that allows us to run Jasmine tests via phantom.</li>
</ul>
<p>There are a few steps to get Istanbul tests on the browser:</p>
<ol>
<li>Manually instrument the source code via <code>istanbul instrument</code></li>
<li>Make the specs use the instrumented source code instead of the actual code</li>
<li>Get the coverage data from <code>window.__coverage__</code> after all tests have been run</li>
<li>Send the data from <code>window.__coverage__</code> to a server so that the coverage data can be saved</li>
<li>Run <code>istanbul report</code> to generate a report out of the coverage data</li>
</ol>
<p>The full repo of a working demo is here: <a href="https://github.com/jiahuang/istanbul-phantom-jasmine" target="_blank" rel="external">https://github.com/jiahuang/istanbul-phantom-jasmine</a></p>
<h2 id="NYC"><a href="#NYC" class="headerlink" title="NYC"></a>NYC</h2><p><a href="https://github.com/istanbuljs/nyc" target="_blank" rel="external">NYC</a> is the newer Istanbul CLI that works with react &amp; ES6. The problem with getting code coverage for ES6 is that only the babel-transformed version of the code actually runs. So a code coverage tool has to un-babelify the code that was run to get the original source code via a <a href="https://blog.sentry.io/2015/10/29/debuggable-javascript-with-source-maps.html" target="_blank" rel="external">source map</a>. Istanbul cannot currently do this, but NYC can.</p>
<p>One of the drawbacks of Istanbul is that it only checks files that have been required. There’s an <a href="https://github.com/gotwarlost/istanbul/issues/112" target="_blank" rel="external">open issue</a> to fix this, but for now a workable solution seems to be just require all files. Being able to see code coverage makes it easier to discover fragile pieces of untested code, and write tests to cover edge cases.</p>
</article></main></body></html>